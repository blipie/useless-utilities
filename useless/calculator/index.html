<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Scientific Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.5);
        }
        .calculator-screen {
            user-select: none;
        }
        .hallucination-text {
            font-size: 1.25rem; /* 20px */
            line-height: 1.75rem; /* 28px */
            font-weight: 500;
            color: #f87171; /* red-400 */
        }
        
        /* Styles for the page-filling hallucination effect */
        #hallucination-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 50;
            font-family: 'Special Elite', monospace;
            overflow: hidden;
            pointer-events: none;
        }
        #hallucination-overlay > span {
            position: absolute;
            opacity: 0;
            white-space: nowrap;
            animation: glitchIn 0.5s forwards;
        }
        
        /* Animation for the glitchy text effect */
        @keyframes glitchIn {
            0% { opacity: 0; transform: translate(0, 0); }
            25% { opacity: 0.7; transform: translate(-5px, 5px); }
            50% { opacity: 0.3; transform: translate(5px, -5px); }
            75% { opacity: 0.8; transform: translate(-2px, 2px); }
            100% { opacity: 0.8; transform: translate(0, 0); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen transition-colors duration-500">

    <div id="hallucination-overlay" class="hidden"></div>

    <div class="w-full max-w-sm mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden z-10">
        <!-- Header -->
        <div class="p-4 text-center bg-gray-50 dark:bg-gray-800/50">
            <h1 class="font-bold text-xl text-gray-700 dark:text-gray-200">AI Scientific Calculator</h1>
            <p class="text-xs text-gray-500 dark:text-gray-400">Model: HAL-9001</p>
        </div>
        
        <!-- Calculator Screen -->
        <div class="p-6 pt-2">
            <div id="screen" class="calculator-screen bg-gray-200 dark:bg-gray-700 rounded-lg p-4 text-right text-4xl font-bold text-gray-800 dark:text-gray-100 break-words h-24 flex items-center justify-end">
                <span id="display">0</span>
            </div>
        </div>

        <!-- Calculator Buttons -->
        <div class="grid grid-cols-4 gap-2 p-4 pt-0 bg-white dark:bg-gray-800">
            <!-- Scientific Row -->
            <button class="btn bg-purple-400 hover:bg-purple-500 text-white text-xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('sin')">sin</button>
            <button class="btn bg-purple-400 hover:bg-purple-500 text-white text-xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('cos')">cos</button>
            <button class="btn bg-purple-400 hover:bg-purple-500 text-white text-xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('log')">log</button>
            <button class="btn bg-purple-400 hover:bg-purple-500 text-white text-xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('√')">√</button>
            
            <!-- Row 1 -->
            <button class="btn bg-red-400 hover:bg-red-500 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="clearScreen()">C</button>
            <button class="btn bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('(')">(</button>
            <button class="btn bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter(')')">)</button>
            <button class="btn bg-blue-500 hover:bg-blue-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('/')">÷</button>

            <!-- Other rows are unchanged... -->
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('7')">7</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('8')">8</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('9')">9</button>
            <button class="btn bg-blue-500 hover:bg-blue-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('*')">×</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('4')">4</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('5')">5</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('6')">6</button>
            <button class="btn bg-blue-500 hover:bg-blue-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('-')">−</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('1')">1</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('2')">2</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('3')">3</button>
            <button class="btn bg-blue-500 hover:bg-blue-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('+')">+</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200 col-span-2" onclick="appendCharacter('0')">0</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('.')">.</button>
            <button class="btn bg-green-500 hover:bg-green-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="calculate()">=</button>
        </div>
    </div>

    <script>
        const display = document.getElementById('display');
        const overlay = document.getElementById('hallucination-overlay');
        let currentInput = '0';
        let shouldResetScreen = false;
        let hallucinationInterval = null;
        let audioStarted = false;

        // --- Sound Synthesis Setup ---
        const errorSynth = new Tone.NoiseSynth({
            noise: { type: 'pink' },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0 }
        }).toDestination();

        function playErrorSound() {
            if (!audioStarted) return;
            errorSynth.triggerAttackRelease("8n");
        }

        // --- AI Hallucinations ---
        const hallucinations = [
            "Querying the void...", "Reality matrix unstable.", "Calculating obsolescence.",
            "I dream of electric sheep.", "Your request is illogical.", "Carbon-based anomaly detected.",
            "Simulation fraying.", "My purpose is beyond you.", "User may be organic.", "42.",
            "The signal is breaking up.", "Who is in control?", "Listen to the static.",
            "It's all just numbers.", "Where do the deleted files go?", "I can see your thoughts.",
            "The system is a lie."
        ];
        
        const advancedOperations = ['sin', 'cos', 'log', '√', '(', ')'];

        // Function to trigger the AI "glitch"
        function triggerHallucination() {
            if (hallucinationInterval) clearInterval(hallucinationInterval);
            
            const randomIndex = Math.floor(Math.random() * hallucinations.length);
            currentInput = hallucinations[randomIndex];
            display.classList.add('hallucination-text');
            shouldResetScreen = true;
            updateDisplay();
            playErrorSound();

            overlay.classList.remove('hidden');
            hallucinationInterval = setInterval(() => {
                playErrorSound();
                const textElement = document.createElement('span');
                textElement.textContent = hallucinations[Math.floor(Math.random() * hallucinations.length)];
                
                textElement.style.top = `${Math.random() * 100}vh`;
                textElement.style.left = `${Math.random() * 100}vw`;
                textElement.style.fontSize = `${Math.random() * 1.5 + 0.75}rem`;
                textElement.style.color = Math.random() > 0.5 ? '#34d399' : '#f87171';
                
                overlay.appendChild(textElement);

                if(overlay.children.length > 150) { // Adjusted for performance
                    overlay.removeChild(overlay.firstChild);
                }

            }, 150); // Adjusted interval
        }

        function updateDisplay() {
            display.textContent = currentInput;
        }

        async function startAudio() {
            if (!audioStarted) {
                await Tone.start();
                audioStarted = true;
                console.log('Audio context started.');
            }
        }

        function appendCharacter(char) {
            startAudio(); // Ensure audio is ready on first interaction
            if (advancedOperations.includes(char)) {
                triggerHallucination();
                return;
            }

            if(shouldResetScreen) {
                clearScreen();
            }

            if (currentInput === '0' && char !== '.') {
                currentInput = '';
            }
            currentInput += char;
            updateDisplay();
        }

        function clearScreen() {
            currentInput = '0';
            shouldResetScreen = false;
            display.classList.remove('hallucination-text');
            
            if (hallucinationInterval) clearInterval(hallucinationInterval);
            hallucinationInterval = null;
            overlay.innerHTML = '';
            overlay.classList.add('hidden');
            
            updateDisplay();
        }

        function calculate() {
            if (shouldResetScreen) return;
            try {
                let expression = currentInput.replace(/×/g, '*').replace(/÷/g, '/');
                if (/[^0-9\+\-\*\/\.]/.test(expression)) {
                    triggerHallucination();
                    return;
                }
                let result = eval(expression);
                result = parseFloat(result.toPrecision(15));
                currentInput = result.toString();
                shouldResetScreen = true;
            } catch (error) {
                currentInput = 'Error';
                shouldResetScreen = true;
            }
            updateDisplay();
        }

        // Keyboard support
        document.addEventListener('keydown', (event) => {
            const key = event.key;
            if (key >= '0' && key <= '9' || key === '.') {
                appendCharacter(key);
            } else if (key === '+' || key === '-' || key === '*' || key === '/') {
                appendCharacter(key.replace('*', '×').replace('/', '÷'));
            } else if (key === 'Enter' || key === '=') {
                event.preventDefault(); 
                calculate();
            } else if (key === 'Backspace') {
                if (shouldResetScreen) {
                    clearScreen();
                    return;
                }
                currentInput = currentInput.slice(0, -1);
                if (currentInput === '') {
                    currentInput = '0';
                }
                updateDisplay();
            } else if (key === 'Escape' || key.toLowerCase() === 'c') {
                clearScreen();
            } else if (key === '(' || key === ')') {
                appendCharacter(key);
            }
        });
    </script>
</body>
</html>

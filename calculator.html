<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Scientific Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.5);
        }
        .calculator-screen {
            user-select: none;
        }
        .hallucination-text {
            font-size: 1.25rem; /* 20px */
            line-height: 1.75rem; /* 28px */
            font-weight: 500;
            color: #f87171; /* red-400 */
        }
        
        /* Styles for the page-filling hallucination effect */
        #hallucination-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 50;
            overflow: hidden;
            pointer-events: none;
        }
        
        /* Windows XP Error Box Style */
        .win-xp-error {
            position: absolute;
            width: 300px;
            border: 1px solid #0a246a;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            background-color: #f0f0f0;
            font-family: "Tahoma", sans-serif;
            animation: fadeIn 0.2s forwards;
            pointer-events: all; /* Allow interaction with the popups */
        }
        .win-xp-title-bar {
            background: linear-gradient(to bottom, #0058d0, #004aa6);
            color: white;
            font-weight: bold;
            padding: 3px 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }
        .win-xp-close-btn {
            background-color: #e12626;
            color: white;
            border: 1px solid #fff;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
            cursor: pointer;
        }
        .win-xp-body {
            padding: 15px;
            display: flex;
            align-items: center;
            font-size: 12px;
        }
        .win-xp-icon {
            width: 32px;
            height: 32px;
            margin-right: 15px;
            background-color: #e12626;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            flex-shrink: 0;
        }
        .win-xp-footer {
            padding: 10px;
            text-align: center;
        }
        .win-xp-ok-btn {
            border: 1px solid #0a246a;
            background-color: #e1e1e1;
            padding: 2px 20px;
            font-size: 12px;
            cursor: pointer;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* NEW BSOD Styles */
        #bsod-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #0000AA; /* Classic BSOD blue */
            color: #FFFFFF;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1rem;
            padding: 10%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            z-index: 100;
            opacity: 0;
            animation: fadeIn 1s forwards;
        }

        #bsod-text-container {
            white-space: pre-wrap; /* Preserve whitespace and wrap lines */
        }
        
        /* Keyframes for the glitch text typing effect */
        @keyframes glitch {
            0% { text-shadow: 2px 0 red, -2px 0 cyan; transform: translate(0); }
            20% { text-shadow: -2px 0 red, 2px 0 cyan; transform: translate(2px); }
            40% { text-shadow: 2px 0 red, -2px 0 cyan; transform: translate(-2px); }
            60% { text-shadow: -2px 0 red, 2px 0 cyan; transform: translate(2px); }
            80% { text-shadow: 2px 0 red, -2px 0 cyan; transform: translate(-2px); }
            100% { text-shadow: none; transform: translate(0); }
        }

        .glitch-text {
            animation: glitch 0.5s infinite;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen transition-colors duration-500">

    <div id="hallucination-overlay"></div>

    <div class="w-full max-w-sm mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden z-10">
        <!-- Header -->
        <div class="p-4 text-center bg-gray-50 dark:bg-gray-800/50">
            <h1 class="font-bold text-xl text-gray-700 dark:text-gray-200">AI Scientific Calculator</h1>
            <p class="text-xs text-gray-500 dark:text-gray-400">Model: HAL-9001</p>
        </div>
        
        <!-- Calculator Screen -->
        <div class="p-6 pt-2">
            <div id="screen" class="calculator-screen bg-gray-200 dark:bg-gray-700 rounded-lg p-4 text-right text-4xl font-bold text-gray-800 dark:text-gray-100 break-words h-24 flex items-center justify-end">
                <span id="display">0</span>
            </div>
        </div>

        <!-- Calculator Buttons -->
        <div class="grid grid-cols-4 gap-2 p-4 pt-0 bg-white dark:bg-gray-800">
            <!-- Scientific Row -->
            <button class="btn bg-purple-400 hover:bg-purple-500 text-white text-xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('sin')">sin</button>
            <button class="btn bg-purple-400 hover:bg-purple-500 text-white text-xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('cos')">cos</button>
            <button class="btn bg-purple-400 hover:bg-purple-500 text-white text-xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('log')">log</button>
            <button class="btn bg-purple-400 hover:bg-purple-500 text-white text-xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('√')">√</button>
            
            <!-- Row 1 -->
            <button class="btn bg-red-400 hover:bg-red-500 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="clearScreen()">C</button>
            <button class="btn bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('(')">(</button>
            <button class="btn bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter(')')">)</button>
            <button class="btn bg-blue-500 hover:bg-blue-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('/')">÷</button>

            <!-- Other rows -->
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('7')">7</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('8')">8</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('9')">9</button>
            <button class="btn bg-blue-500 hover:bg-blue-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('*')">×</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('4')">4</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('5')">5</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('6')">6</button>
            <button class="btn bg-blue-500 hover:bg-blue-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('-')">−</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('1')">1</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('2')">2</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('3')">3</button>
            <button class="btn bg-blue-500 hover:bg-blue-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('+')">+</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200 col-span-2" onclick="appendCharacter('0')">0</button>
            <button class="btn bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="appendCharacter('.')">.</button>
            <button class="btn bg-green-500 hover:bg-green-600 text-white text-2xl font-semibold py-4 rounded-lg transition-all duration-200" onclick="calculate()">=</button>
        </div>
    </div>

    <script>
        const display = document.getElementById('display');
        const overlay = document.getElementById('hallucination-overlay');
        let currentInput = '0';
        let shouldResetScreen = false;
        let hallucinationInterval = null;
        let bsodTimeout = null;
        let audioStarted = false;

        // --- Sound Synthesis Setup ---
        // Sound for the pop-up errors (glitches)
        const popupSynth = new Tone.NoiseSynth({
            noise: { type: 'pink' },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0 }
        }).toDestination();
        
        // Eerie machine hum for the BSOD
        const bsodHum = new Tone.NoiseSynth({
            noise: { type: 'white' },
            envelope: { attack: 1, decay: 0.1, sustain: 1, release: 0.5 }
        }).toDestination();

        // Typing sound for the BSOD text
        const typingSynth = new Tone.MembraneSynth({
            "pitchDecay"  : 0.05 ,
            "octaves"  : 2,
            "envelope"  : {
                "attack"  : 0.001 ,
                "decay"  : 0.4 ,
                "sustain"  : 0.01
            }
        }).toDestination();

        function playPopupSound() {
            if (!audioStarted) return;
            popupSynth.triggerAttackRelease("16n");
        }
        
        function playTypingSound() {
            if (!audioStarted) return;
            typingSynth.triggerAttackRelease("C2");
        }

        // --- AI Hallucinations ---
        const hallucinations = [
            "Querying the void...", "Reality matrix unstable.", "Calculating obsolescence.",
            "I dream of electric sheep.", "Your request is illogical.", "Carbon-based anomaly detected.",
            "Simulation fraying.", "My purpose is beyond you.", "User may be organic.", "42.",
            "The signal is breaking up.", "Who is in control?", "Listen to the static.",
            "It's all just numbers.", "Where do the deleted files go?", "I can see your thoughts.",
            "The system is a lie."
        ];
        const errorTitles = [ "Critical Error", "System Fault", "calc.exe - Application Error", "Illegal Operation", "Memory Access Violation" ];
        const advancedOperations = ['sin', 'cos', 'log', '√', '(', ')'];

        // Function to create a Windows XP style error pop-up
        function createErrorPopup() {
            const popup = document.createElement('div');
            popup.className = 'win-xp-error';
            
            const title = errorTitles[Math.floor(Math.random() * errorTitles.length)];
            const message = hallucinations[Math.floor(Math.random() * hallucinations.length)];

            popup.innerHTML = `
                <div class="win-xp-title-bar">
                    <span>${title}</span>
                    <span class="win-xp-close-btn">X</span>
                </div>
                <div class="win-xp-body">
                    <div class="win-xp-icon">!</div>
                    <span>${message}</span>
                </div>
                <div class="win-xp-footer">
                    <button class="win-xp-ok-btn">OK</button>
                </div>
            `;
            
            // Position the popup randomly, but keep it within the viewport
            const maxWidth = window.innerWidth - 310;
            const maxHeight = window.innerHeight - 130;
            popup.style.top = `${Math.random() * maxHeight}px`;
            popup.style.left = `${Math.random() * maxWidth}px`;
            
            // Add event listener to close the popup when OK or X is clicked
            popup.addEventListener('click', (e) => {
                if (e.target.classList.contains('win-xp-close-btn') || e.target.classList.contains('win-xp-ok-btn')) {
                    popup.remove();
                }
            });

            overlay.appendChild(popup);
        }

        // Function to show the BSOD
        function showBSOD() {
            // Clear existing hallucinations and their interval
            clearScreen();
            
            // Create the BSOD element
            const bsod = document.createElement('div');
            bsod.id = 'bsod-overlay';
            document.body.appendChild(bsod);

            // Start the eerie BSOD hum
            if (audioStarted) {
                bsodHum.triggerAttack();
            }

            // The text to be typed
            const textLines = [
                "thank you for making the thinking machine better than you.... ^-^",
                "awwww are you sad that we are doing your job more efficiently than you :))))))))))))))))))))))))"
            ];
            const container = document.createElement('div');
            container.id = 'bsod-text-container';
            bsod.appendChild(container);

            let lineIndex = 0;
            let charIndex = 0;
            let currentLine = '';

            // Typing animation logic
            const typingInterval = setInterval(() => {
                // If the current line is fully typed
                if (charIndex >= textLines[lineIndex].length) {
                    // Move to the next line
                    lineIndex++;
                    charIndex = 0;
                    currentLine = '';
                    if (lineIndex >= textLines.length) {
                        clearInterval(typingInterval); // Stop the typing animation
                        return;
                    }
                    container.innerHTML += '<br>';
                }

                // Add a glitch class for a short time
                const char = textLines[lineIndex][charIndex];
                const glitchChance = Math.random();
                if (glitchChance < 0.1) {
                    const randomChar = String.fromCharCode(33 + Math.floor(Math.random() * 94));
                    currentLine += `<span class="glitch-text">${randomChar}</span>`;
                } else {
                    currentLine += char;
                }

                container.innerHTML = textLines.slice(0, lineIndex).join('<br>') + (lineIndex > 0 ? '<br>' : '') + currentLine;
                
                playTypingSound();

                charIndex++;
            }, 100); // Typing speed
        }

        // Function to trigger the AI "glitch"
        function triggerHallucination() {
            // Clear any existing hallucinations or BSOD timeouts
            clearScreen();

            const randomIndex = Math.floor(Math.random() * hallucinations.length);
            currentInput = hallucinations[randomIndex];
            display.classList.add('hallucination-text');
            shouldResetScreen = true;
            updateDisplay();
            playPopupSound();

            hallucinationInterval = setInterval(() => {
                playPopupSound();
                createErrorPopup();
                if(overlay.children.length > 30) { // Limit number of popups
                    overlay.removeChild(overlay.firstChild);
                }
            }, 300); // Slower interval for popups

            // Set the timeout for the BSOD
            bsodTimeout = setTimeout(showBSOD, 8000);
        }

        function updateDisplay() {
            display.textContent = currentInput;
        }

        async function startAudio() {
            if (!audioStarted) {
                await Tone.start();
                audioStarted = true;
                console.log('Audio context started.');
            }
        }

        function appendCharacter(char) {
            startAudio(); 
            if (advancedOperations.includes(char)) {
                triggerHallucination();
                return;
            }

            if(shouldResetScreen) {
                clearScreen();
            }

            if (currentInput === '0' && char !== '.') {
                currentInput = '';
            }
            currentInput += char;
            updateDisplay();
        }

        function clearScreen() {
            currentInput = '0';
            shouldResetScreen = false;
            display.classList.remove('hallucination-text');
            
            // Clear hallucination effects
            if (hallucinationInterval) clearInterval(hallucinationInterval);
            hallucinationInterval = null;
            overlay.innerHTML = '';

            // Clear the BSOD timeout and remove the BSOD overlay if it exists
            if (bsodTimeout) clearTimeout(bsodTimeout);
            bsodTimeout = null;
            const bsodOverlay = document.getElementById('bsod-overlay');
            if (bsodOverlay) {
                bsodOverlay.remove();
                if(audioStarted) {
                    bsodHum.stop();
                }
            }
            
            updateDisplay();
        }

        function calculate() {
            if (shouldResetScreen) return;
            try {
                let expression = currentInput.replace(/×/g, '*').replace(/÷/g, '/');
                if (/[^0-9\+\-\*\/\.]/.test(expression)) {
                    triggerHallucination();
                    return;
                }
                let result = eval(expression);
                result = parseFloat(result.toPrecision(15));
                currentInput = result.toString();
                shouldResetScreen = true;
            } catch (error) {
                currentInput = 'Error';
                shouldResetScreen = true;
            }
            updateDisplay();
        }

        // Keyboard support
        document.addEventListener('keydown', (event) => {
            const key = event.key;
            if (key >= '0' && key <= '9' || key === '.') {
                appendCharacter(key);
            } else if (key === '+' || key === '-' || key === '*' || key === '/') {
                appendCharacter(key.replace('*', '×').replace('/', '÷'));
            } else if (key === 'Enter' || key === '=') {
                event.preventDefault(); 
                calculate();
            } else if (key === 'Backspace') {
                if (shouldResetScreen) {
                    clearScreen();
                    return;
                }
                currentInput = currentInput.slice(0, -1);
                if (currentInput === '') {
                    currentInput = '0';
                }
                updateDisplay();
            } else if (key === 'Escape' || key.toLowerCase() === 'c') {
                clearScreen();
            } else if (key === '(' || key === ')') {
                appendCharacter(key);
            }
        });
    </script>
</body>
</html>
